#!/bin/sh

# ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
# ‚ïë     Instalador de Dotfiles con     ‚ïë
# ‚ïë         Stow - por migbert         ‚ïë
# ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üé® Colores ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
CRE=$(tput setaf 1)   # Rojo
CYE=$(tput setaf 3)   # Amarillo
CGR=$(tput setaf 2)   # Verde
CBL=$(tput setaf 4)   # Azul
BLD=$(tput bold)      # Negrita
CNC=$(tput sgr0)      # Reset

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üìÅ Variables ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
DOTFILES_DIR="$HOME/dotfiles"
ERROR_LOG="$HOME/dotfiles_install_error.log"

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üñº Logo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
logo() {

  local text="${1:?}"
  echo -en "


‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù
‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù   ‚ñà‚ñà‚ïë   
‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïë   
‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   
‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù   
                                                        
    Mis Dotfiles\n\n"
  printf   "${BLD}${CRE}[ ${CYE}${text} ${CRE}]${CNC}\n\n"
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ö†Ô∏è Registrar errores ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
log_error() {
    msg=$1
    ts=$(date +"%F %T")
    echo "[${ts}] ERROR: $msg" >> "$ERROR_LOG"
    echo "${CRE}${BLD}ERROR:${CNC} $msg" >&2
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üßæ Resultados por secci√≥n ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
SUMMARY=""
add_summary() {
    local status="$1"  # ‚úî, ‚ùå, ‚ö†
    local label="$2"   # Descripci√≥n
    SUMMARY="${SUMMARY}${status} ${label}\n"
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚úÖ Verificaciones iniciales ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
initial_checks() {
    if [ "$(id -u)" = 0 ]; then
        log_error "No ejecutes este script como root."
        exit 1
    fi
    if [ ! -d "$DOTFILES_DIR" ]; then
        log_error "No se encontr√≥ el directorio '$DOTFILES_DIR'."
        exit 1
    fi
        # Verificar directorio HOME
    if [ "$PWD" != "$HOME" ]; then
        log_error "El script debe ejecutarse desde el directorio HOME."
        exit 1
    fi
    # Verificar conexi√≥n a internet
    if ! ping -q -c 1 -W 1 8.8.8.8 >/dev/null 2>&1; then
        log_error "No se detect√≥ conexi√≥n a internet."
        exit 1
    fi
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üîç Verifica si un paquete est√° instalado ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
is_installed() {
    pacman -Q "$1" >/dev/null 2>&1
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üì¶ Instalar dependencias con validaci√≥n ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
install_dependencies() {
    clear
    logo "Instalando paquetes necesarios desde los repositorios oficiales..."
    sleep 1

    # Actualizar mirrors si reflector est√° instalado
    if is_installed reflector; then
        printf "%b\n" "${BLD}${CGR}Actualizando lista de mirrors con reflector...${CNC}"
        sudo reflector --verbose --age 12 --fastest 10 --score 10 --protocol https \
                       --latest 8 --sort rate --save /etc/pacman.d/mirrorlist
        sudo pacman -Syy
    else
        printf "%b\n" "${BLD}${CYE}Reflector no est√° instalado. Saltando actualizaci√≥n de mirrors...${CNC}"
    fi

    # Lista de paquetes necesarios
    dependencies="
        btop conky microsoft-edge-stable-bin google-chrome gimp inkscape thunderbird auto-cpufreq tlp acpi acpid xprintidle docker docker-compose php keepassxc nextcloud-client plank vlc syncthing obs-studio telegram-desktop signal-desktop shotcut visual-studio-code-bin wireguird stow ripgrep fastfetch udiskie ffmpegthumbnailer unrar p7zip zip unzip lrzip sed curl lazygit dex eza bluez bluez-utils polkit-gnome gnome-keyring ranger tldr zoxide fd xclip lxappearance jq xdg-desktop-portal ffmpeg xdg-desktop-portal-gtk xorg-xwininfo bat brightnessctl zram-generator gparted rsync
    "

    printf "\n%b\n\n" "${BLD}${CBL}Verificando paquetes requeridos...${CNC}"
    sleep 1

    # Buscar paquetes faltantes
    missing_pkgs=""
    for pkg in $dependencies; do
        if ! is_installed "$pkg"; then
            missing_pkgs="$missing_pkgs $pkg"
            printf "  %b %b\n" "${BLD}${CYE}‚úò $pkg${CNC}" "${CRE}(no instalado)${CNC}"
        else
            printf "  %b %b\n" "${BLD}${CGR}‚úî $pkg${CNC}" "${CBL}(ya instalado)${CNC}"
        fi
    done

    # Instalar si hay paquetes faltantes
    if [ -n "$missing_pkgs" ]; then
        total=$(echo "$missing_pkgs" | wc -w)
        printf "\n%b %s\n\n" "${BLD}${CYE}Instalando $total paquetes faltantes...${CNC}" "$missing_pkgs"

        if sudo pacman -S --noconfirm $missing_pkgs 2>&1 | tee -a "$ERROR_LOG" >/dev/null; then
            failed=""
            for pkg in $missing_pkgs; do
                is_installed "$pkg" || failed="$failed $pkg"
            done

            if [ -z "$failed" ]; then
                printf "%b\n\n" "${BLD}${CGR}‚úÖ ¬°Todos los paquetes fueron instalados correctamente!${CNC}"
            else
                fail_count=$(echo "$failed" | wc -w)
                printf "%b\n" "${BLD}${CRE}‚ùå Fallaron $fail_count paquetes:${CNC}"
                printf "  %s\n" "$failed"
            fi
        else
            log_error "Error cr√≠tico al instalar: $missing_pkgs"
            printf "%b\n" "${BLD}${CRE}‚ö†Ô∏è Fall√≥ la instalaci√≥n. Revisa el archivo de log.${CNC}"
            return 1
        fi
    else
        printf "\n%b\n" "${BLD}${CGR}‚úÖ Todos los paquetes ya est√°n instalados.${CNC}"
    fi

    sleep 2
}
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üì• Clonar dotfiles desde un repositorio ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
clone_dotfiles() {
    clear
    logo "Descargando Dotfiles..."

    # Cambia esta URL por la de tu repositorio personal
    repo_url="https://github.com/migbertweb/dotfiles"
    repo_dir="$HOME/dotfiles"
    timestamp=$(date +"%Y%m%d-%H%M%S")
    sleep 1

    # Si ya existe el directorio, hacer backup
    if [ -d "$repo_dir" ]; then
        backup_dir="${repo_dir}_respaldo_$timestamp"
        printf "%b\n" "${BLD}${CYE}Directorio existente encontrado.${CNC}"
        printf "%b\n" "${BLD}${CYE}Moviendo '$repo_dir' a '${CBL}${backup_dir}${CNC}'"
        mv -v "$repo_dir" "$backup_dir"
    fi

    # Clonar desde el repositorio
    printf "%b\n" "${BLD}${CBL}Clonando desde: ${repo_url}${CNC}"
    if git clone --depth=1 "$repo_url" "$repo_dir" >> "$ERROR_LOG" 2>&1; then
        printf "%b\n\n" "${BLD}${CGR}‚úÖ Dotfiles clonados correctamente en '$repo_dir'${CNC}"
    else
        log_error "Fallo al clonar el repositorio: $repo_url"
        printf "%b\n" "${BLD}${CRE}‚ùå Error al clonar. Revisa el log: ${CYE}$ERROR_LOG${CNC}"
        return 1
    fi

    sleep 2
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üóÉÔ∏è Respaldar configuraciones existentes ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
backup_existing_config() {
    clear
    logo "Respaldando configuraciones existentes..."

    fecha=$(date +%Y%m%d-%H%M%S)
    backup_folder="$HOME/.dotfiles_backup_$fecha"
    mkdir -p "$backup_folder" 2>> "$ERROR_LOG"

    printf "%b\n\n" "${BLD}${CYE}Directorio de respaldo: ${CBL}$backup_folder${CNC}"
    sleep 1

    # ‚îÄ‚îÄ Funci√≥n interna para mover ‚îÄ‚îÄ
    backup_item() {
        tipo=$1
        ruta=$2
        nombre=$3

        existe=0
        [ "$tipo" = "d" ] && [ -d "$ruta" ] && existe=1
        [ "$tipo" = "f" ] && [ -f "$ruta" ] && existe=1

        if [ "$existe" -eq 1 ]; then
            if mv "$ruta" "$backup_folder/${nombre}_${fecha}" 2>> "$ERROR_LOG"; then
                printf " %b%s %s‚úî Copia realizada%s\n" "$BLD" "$nombre" "$CGR" "$CNC"
            else
                log_error "Error al respaldar: $nombre"
                printf " %b%s %s‚úò Fallo al copiar%s\n" "$BLD$CRE" "$nombre" "$CYE" "$CNC"
            fi
        else
            printf " %b%s %s(no encontrado)%s\n" "$BLD$CYE" "$nombre" "$CBL" "$CNC"
        fi
        sleep 0.3
    }

    # ‚îÄ‚îÄ Carpetas de configuraci√≥n principales ‚îÄ‚îÄ
    config_folders="
        alacritty bat conky environment.d gtk-3.0 kitty mpd ncmpcpp nvim paru ranger tmux
    "

    for folder in $config_folders; do
        backup_item d "$HOME/.config/$folder" "$folder"
    done

    # ‚îÄ‚îÄ Archivos sueltos ‚îÄ‚îÄ
    single_files="
        $HOME/.zshrc
        $HOME/.gtkrc-2.0
        $HOME/.icons
    "

    for item in $single_files; do
        base=$(basename "$item")
        [ "$base" = ".icons" ] && backup_item d "$item" "$base" || backup_item f "$item" "$base"
    done

    printf "\n%b\n\n" "${BLD}${CGR}‚úÖ Respaldo completo.${CNC}"
    sleep 2
}


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üß© Enlazar dotfiles con Stow ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
stow_dotfiles() {
    clear
    logo "üß© Aplicando enlaces simb√≥licos con Stow..."

    cd "$DOTFILES_DIR" || {
        log_error "No se pudo acceder al directorio \$DOTFILES_DIR: $DOTFILES_DIR"
        return 1
    }

    # Enlazar config/ a ~/.config
    if [ -d config ]; then
        echo "‚Üí Enlazando 'config' a ~/.config"
        if stow --target="$HOME/.config" config; then
            echo "${CGR}‚úî Enlace de 'config' completado.${CNC}"
        else
            log_error "‚ùå Error al enlazar 'config' a ~/.config"
        fi
    else
        echo "${CYE}‚ö†Ô∏è  Carpeta 'config' no encontrada. Omitiendo...${CNC}"
    fi

    # Enlazar home/ a ~
    if [ -d home ]; then
        echo "‚Üí Enlazando 'home' a ~"
        if stow --target="$HOME" home; then
            echo "${CGR}‚úî Enlace de 'home' completado.${CNC}"
        else
            log_error "‚ùå Error al enlazar 'home' a ~"
        fi
    else
        echo "${CYE}‚ö†Ô∏è  Carpeta 'home' no encontrada. Omitiendo...${CNC}"
    fi

    # Copiar misc/ a ~/.local/
    if [ -d misc ]; then
        echo "‚Üí Copiando contenido de 'misc' a ~/.local/ con rsync"
        mkdir -p "$HOME/.local"
        if rsync -a misc/ "$HOME/.local/"; then
            echo "${CGR}‚úî Copia de 'misc' completada.${CNC}"
        else
            log_error "‚ùå Error al copiar contenido de 'misc' a ~/.local/"
        fi
    else
        echo "${CYE}‚ö†Ô∏è  Carpeta 'misc' no encontrada. Omitiendo...${CNC}"
    fi

    cd - >/dev/null || true
}
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üìÇ Copiar dotfiles/bspwm ‚Üí ~/.config/bspwm (sin borrar nada) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
merge_bspwm_config() {
    SRC="$DOTFILES_DIR/bspwm"
    DEST="$HOME/.config/bspwm"

    logo "Actualizando configuraci√≥n de BSPWM (sin borrar contenido)..."

    if [ ! -d "$SRC" ]; then
        log_error "No se encontr√≥ la carpeta '$SRC'."
        add_summary "‚ö†" "No se encontr√≥ 'bspwm' en dotfiles"
        return 1
    fi

    mkdir -p "$DEST"

    echo "${CBL}üìÅ Copiando archivos desde '${SRC}' a '${DEST}'...${CNC}"
    if rsync -a "$SRC/" "$DEST/" 2>> "$ERROR_LOG"; then
        echo "${CGR}‚úî Configuraci√≥n de BSPWM actualizada (sin borrar archivos existentes).${CNC}"
        add_summary "‚úî" "bspwm actualizado sin borrar"
    else
        log_error "Error al copiar archivos a ~/.config/bspwm"
        add_summary "‚ùå" "Error al actualizar bspwm"
        return 1
    fi
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üê≥ Configuraci√≥n de Docker ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
configure_docker() {
    clear
    logo "Configurando Docker..."
    sleep 1

    echo "${BLD}${CBL}üîß Verificando estado del servicio Docker...${CNC}"
    if systemctl is-enabled --quiet docker.service && systemctl is-active --quiet docker.service; then
        echo "${CGR}‚úî Docker ya est√° habilitado y en ejecuci√≥n.${CNC}"
    else
        echo "${CBL}üîß Habilitando e iniciando Docker...${CNC}"
        if sudo systemctl enable --now docker.service; then
            echo "${CGR}‚úî Docker habilitado y en ejecuci√≥n.${CNC}"
        else
            log_error "No se pudo habilitar o iniciar el servicio docker.service"
            return 1
        fi
    fi

    sleep 2

    echo "${CBL}üë§ Verificando si el usuario '$USER' ya pertenece al grupo 'docker'...${CNC}"
    if groups "$USER" | grep -qw docker; then
        echo "${CGR}‚úî Usuario ya est√° en el grupo docker.${CNC}"
    else
        echo "${CBL}‚ûï A√±adiendo usuario al grupo docker...${CNC}"
        if sudo usermod -aG docker "$USER"; then
            echo "${CGR}‚úî Usuario a√±adido al grupo docker.${CNC}"
            echo "${CYE}‚ö†Ô∏è  Ejecuta 'newgrp docker' o cierra sesi√≥n para aplicar los cambios.${CNC}"
        else
            log_error "No se pudo a√±adir el usuario '$USER' al grupo docker"
            return 1
        fi
    fi

    sleep 2
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üîÑ Habilitar Syncthing como servicio de usuario ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
configure_syncthing() {
    clear
    logo "Habilitando el servicio de SYNCTHING"

    printf "\n%s%süîß Verificando estado de Syncthing (usuario)...%s\n" "${BLD}" "${CYE}" "${CNC}"

    if systemctl --user is-enabled --quiet syncthing.service && systemctl --user is-active --quiet syncthing.service; then
        printf "%s%s‚úî Syncthing ya est√° habilitado y en ejecuci√≥n.%s\n\n" "${BLD}" "${CGR}" "${CNC}"
    else
        printf "%s%s‚ûï Habilitando e iniciando syncthing.service...%s\n" "${BLD}" "${CBL}" "${CNC}"
        if systemctl --user enable --now syncthing.service; then
            printf "%s%s‚úÖ ¬°Syncthing habilitado correctamente!%s\n\n" "${BLD}" "${CGR}" "${CNC}"
        else
            log_error "No se pudo habilitar el servicio syncthing.service (usuario)"
            return 1
        fi
    fi

    sleep 2
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ö° Habilitar auto-cpufreq y TLP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
configure_power_services() {
    clear
    logo "Habilitando servicios de optimizaci√≥n de energ√≠a"

    echo "${CBL}‚öôÔ∏è  Verificando estado de auto-cpufreq...${CNC}"
    if systemctl is-enabled --quiet auto-cpufreq.service && systemctl is-active --quiet auto-cpufreq.service; then
        echo "${CGR}‚úî auto-cpufreq ya est√° activo.${CNC}"
    else
        echo "${CBL}‚ûï Habilitando auto-cpufreq...${CNC}"
        if sudo systemctl enable --now auto-cpufreq.service; then
            echo "${CGR}‚úî auto-cpufreq habilitado.${CNC}"
        else
            log_error "No se pudo habilitar auto-cpufreq.service"
        fi
    fi

    echo "${CBL}‚öôÔ∏è  Verificando estado de TLP...${CNC}"
    if systemctl is-enabled --quiet tlp.service && systemctl is-active --quiet tlp.service; then
        echo "${CGR}‚úî TLP ya est√° activo.${CNC}"
    else
        echo "${CBL}‚ûï Habilitando TLP...${CNC}"
        if sudo systemctl enable --now tlp.service; then
            echo "${CGR}‚úî TLP habilitado.${CNC}"
        else
            log_error "No se pudo habilitar tlp.service"
        fi
    fi

    sleep 2
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üß† Habilitar ZRAM con systemd zram-generator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
configure_zram() {
    clear
    logo "Habilitando ZRAM"

    CONFIG_FILE="/etc/systemd/zram-generator.conf"
    SERVICE_NAME="systemd-zram-setup@zram0"

    # Solicitar privilegios si no se tiene
    if [ "$(id -u)" -ne 0 ]; then
        echo "${CYE}üîê Se requieren privilegios de superusuario. Solicitando...${CNC}"
        if ! sudo -v; then
            echo "${CRE}${BLD}No se pudo obtener acceso root. Abortando.${CNC}"
            return 1
        fi
    fi

    # Verificar si el archivo ya existe
    if [ -f "$CONFIG_FILE" ]; then
        echo "${CYE}‚ö†Ô∏è  La configuraci√≥n de ZRAM ya existe en:${CNC} $CONFIG_FILE"
    else
        echo "${CBL}üìÑ Creando configuraci√≥n ZRAM en:${CNC} $CONFIG_FILE"
        sudo tee "$CONFIG_FILE" > /dev/null <<EOF
[zram0]
zram-size = ram * 0.25
compression-algorithm = zstd
swap-priority = 100
EOF
    fi

    # Verificar si el servicio ya est√° habilitado y activo
    echo "${CBL}üîÑ Verificando estado de ${SERVICE_NAME}...${CNC}"
    if systemctl is-enabled --quiet "$SERVICE_NAME" && systemctl is-active --quiet "$SERVICE_NAME"; then
        echo "${CGR}‚úî ZRAM ya est√° habilitado y activo.${CNC}"
    else
        echo "${CBL}‚ûï Activando ZRAM...${CNC}"
        sudo systemctl daemon-reload
        sudo systemctl start "$SERVICE_NAME"
    fi
    echo ""
    echo "${CBL}üìà Resumen actual de ZRAM:${CNC}"
    zramctl

    sleep 2
    clear
}

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ñ∂Ô∏è Ejecuci√≥n ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
main() {
    logo "üõ† Instalador de Dotfiles"
    initial_checks

    #install_dependencies && add_summary "‚úî" "Dependencias verificadas e instaladas" || add_summary "‚ùå" "Fall√≥ la instalaci√≥n de dependencias"

    clone_dotfiles && add_summary "‚úî" "Dotfiles clonados" || add_summary "‚ùå" "Fallo al clonar los dotfiles"

    backup_existing_config && add_summary "‚úî" "Configuraciones respaldadas" || add_summary "‚ùå" "Error al respaldar configuraciones"

    stow_dotfiles && add_summary "‚úî" "Dotfiles enlazados con Stow" || add_summary "‚ùå" "Error al aplicar Stow"
    
    merge_bspwm_config && add_summary "‚úî" "Configuraci√≥n de BSPWM actualizada" || add_summary "‚ùå" "Error al actualizar BSPWM"

    configure_docker && add_summary "‚úî" "Docker configurado" || add_summary "‚ùå" "Fallo en configuraci√≥n de Docker"

    configure_syncthing && add_summary "‚úî" "Syncthing habilitado" || add_summary "‚ùå" "Fallo al habilitar Syncthing"

    configure_power_services && add_summary "‚úî" "Servicios de energ√≠a habilitados" || add_summary "‚ùå" "Fallo al habilitar servicios de energ√≠a"

    configure_zram && add_summary "‚úî" "ZRAM habilitado" || add_summary "‚ùå" "Fallo en configuraci√≥n de ZRAM"

    echo ""
    echo "${BLD}${CBL}üìã Resumen de la instalaci√≥n:${CNC}"
    echo -e "${SUMMARY}"
    
    echo "${BLD}${CGR}‚úÖ Todo configurado. Reinicia tu sesi√≥n para aplicar los cambios.${CNC}"
}


main
